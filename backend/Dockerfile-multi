# Stage 1: Build the application with Gradle
FROM gradle:8.4.0-jdk21 AS GRADLE_TOOL_CHAIN
WORKDIR /app
COPY build.gradle.kts settings.gradle.kts /app/
COPY src /app/src
RUN gradle clean build

FROM amazoncorretto:17
COPY --from=GRADLE_TOOL_CHAIN /tmp/build/libs/backend-0.0.1-SNAPSHOT.jar app.jar
EXPOSE 8080
CMD ["java", "-jar", "app.jar"]

# multistage spring kotlin build for java 21
#FROM gradle:8.4.0-jdk21 AS GRADLE_TOOL_CHAIN
#COPY . /tmp/
#WORKDIR /tmp/
#RUN ./gradlew build --no-daemon
#
# production
#FROM amazoncorretto:21
#EXPOSE 8080
#COPY --from=GRADLE_TOOL_CHAIN /tmp/build/libs/backend-0.0.1-SNAPSHOT.jar app.jar
#ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]
